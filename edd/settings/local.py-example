""" This is an example of modifications to settings to use for local development. You can use this
    example by renaming the file and removing the -example suffix, and the local version will use
    these modified settings.
"""

import environ
import errno
import os

# Use everything in the common settings file
from .base import *  # noqa

root = environ.Path(__file__) - 3  # we get this out of `from .base import *` too

# Override the default MANAGERS and ADMINS
MANAGERS = ADMINS = (
    ('Jay Bay', 'admin@example.org'),  # <-- CHANGE ME
)

ALLOWED_HOSTS = ['*', ]
# Set the IPs where the Django debug toolbar will be available; use localhost IPv4 and IPv6
INTERNAL_IPS = ['127.0.0.1', '::1', ]
# Also add the 'external' IP for the nginx service proxying the appserver
try:
    import socket
    INTERNAL_IPS.append(socket.gethostbyname('nginx'))
except:
    pass
# Add the Django Debug Toolbar to local instance
# Add login providers
# INSTALLED_APPS = INSTALLED_APPS + (
#     'allauth.socialaccount.providers.github',
#     'allauth.socialaccount.providers.google',
#     'allauth.socialaccount.providers.linkedin_oauth2',
#     'debug_toolbar',
# )

# Add the Django Debug Toolbar to local instance
# DEBUG_TOOLBAR_CONFIG = {
#     'JQUERY_URL': '/static/main/js/lib/jquery/jquery-2.1.4.min.js',
# }

USE_CELERY = True

# disable the initial new REST API by default since it's insecure. Only needed to support 
# create_lines.py and maintain_ice_links.py
PUBLISH_REST_API = False  

# True disables all study creation by non-superusers. Used to disable writes to the public EDD
# until the "web of EDD's" can be implemented.
EDD_ONLY_SUPERUSER_CREATE = False


###################################################################################################
# You can override the default logging configuration
def get_log_filename(name='edd.log'):
    logdir = root('log')
    try:
        os.mkdir(logdir)
    except OSError as e:
        if e.errno != errno.EEXIST:
            raise e
    return root('log', name)

LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'simple': {
            'format': '%(asctime)s Thread %(thread)d %(name)-12s %(levelname)-8s %(message)s',
        },
    },
    'filters': {
        'require_debug_true': {
            '()': 'django.utils.log.RequireDebugTrue',
        },
    },
    'handlers': {
        'console': {
            'level': 'DEBUG',
            'filters': ['require_debug_true', ],
            'class': 'logging.StreamHandler',
            'formatter': 'simple',
        },
        'file': {
            'level': 'DEBUG',
            'class': 'logging.FileHandler',
            'filename': get_log_filename(),
            'formatter': 'simple',
        },
        'queryfile': {
            'level': 'DEBUG',
            'class': 'logging.FileHandler',
            'filename': get_log_filename('query.log'),
            'formatter': 'simple',
        },
    },
    'loggers': {
        'django.db.backends': {
            'level': 'DEBUG',
            'handlers': ['console', 'queryfile', ],
            'propagate': False,
        },
        'main': {
            'level': 'DEBUG',
            'handlers': ['console', 'file', ],
            'propagate': False,
        },
        'edd': {
            'level': 'DEBUG',
            'handlers': ['console', 'file', ],
            'propagate': False,
        },
        '': {
            'level': 'DEBUG',
            'handlers': ['console', ],
        }
    },
}
