// File last modified on: Wed Oct 26 2016 11:57:45  
/// <reference path="../typings/d3/d3.d.ts"/>;
var StudyHelper;
StudyHelper = {
    /** this function takes in element and returns an array of selectors
     * [<div id=​"linechart">​</div>​, <div id=​"timeBar">​</div>​, <div id=​"single">​</div>​,
     * <div id=​"barAssay">​</div>​]
     */
    getButtonElement: function (element) {
        return $(element.siblings(':first')).find("label");
    },
    /**
     * this function takes in the graphDiv element and returns an array of 4 buttons
     */
    getSelectorElement: function (element) {
        if ($(element).attr('id') != 'maingraph') {
            var selector = element.siblings().eq(1);
            return $(selector).children();
        }
        else {
            return element.siblings().addBack();
        }
    },
    /** this function takes in an element  selector and an array of svg rects and returns
     * returns message or nothing.
     */
    svgWidth: function (selector, rectArray) {
        $('.tooMuchData').remove();
        $('.noData').remove();
        var sum = 0;
        _.each(rectArray, function (rectElem) {
            if (rectElem.getAttribute("width") != 0) {
                sum++;
            }
        });
        if (sum === 0) {
            $(selector).prepend("<p class=' tooMuchData'>Too many data points to display" +
                "</p><p  class=' tooMuchData'>Recommend filtering by protocol</p>");
        }
    },
    /** this function takes in the EDDData.MeasurementTypes object and returns the measurement type
     *  that has the most data points - options are based on family p, m, -, etc.
     */
    measurementType: function (types) {
        var proteomics = {};
        for (var type in types) {
            if (proteomics.hasOwnProperty(types[type].family)) {
                proteomics[types[type].family]++;
            }
            else {
                proteomics[types[type].family] = 0;
            }
        }
        for (var key in proteomics) {
            var max = 0;
            var maxType;
            if (proteomics[key] > max) {
                max = proteomics[key];
                maxType = key;
            }
        }
        return maxType;
    },
    /** this function takes in the selected button and an array of button selectors and activates
     *  or deactivates buttons.
     */
    barGraphActiveButton: function (selectedButton, buttons) {
        var barButton = buttons[1];
        $(buttons).removeClass('active');
        $(barButton).addClass('active');
        $(selectedButton).addClass('active');
    },
    /**
     * this function takes in the selector object and selector type and displays or hides the graph
     */
    displayGraph: function (selectors, selector) {
        for (var key in selectors) {
            if (key === selector) {
                d3.select(selectors[key]).style('display', 'block');
            }
            else {
                d3.select(selectors[key]).style('display', 'none');
            }
        }
    },
    /**
     * this function takes in the event, selector type, rect obj, selector object and
     * handles the button event.
     */
    buttonEventHandler: function (newSet, event, rect, selector, selectors, buttonArr) {
        event.preventDefault();
        if (newSet.length === 0) {
            $(selectors[selector]).prepend("<p class='noData'>No data selected - please " +
                "filter</p>");
            $('.tooMuchData').remove();
        }
        else {
            $('.noData').remove();
            StudyHelper.svgWidth(selectors[selector], rect);
        }
        StudyHelper.displayGraph(selectors, selector);
        StudyHelper.barGraphActiveButton(this, buttonArr);
        return false;
    },
    /**
     * this function takes in the type of measurement, selectors obj, selector type and
     * button obj and shows the measurement graph is the main type is proteomic
     */
    showProteomicGraph: function (type, selectors, selector, buttons) {
        if (type === 'p') {
            d3.select(selectors['line']).style('display', 'none');
            d3.select(selectors['bar-measurement']).style('display', 'block');
            $('label.btn').removeClass('active');
            var rects = d3.selectAll('.groupedMeasurement rect')[0];
            StudyHelper.svgWidth(selectors[selector], rects);
            var button = $('.groupByMeasurementBar')[0];
            $(buttons['bar-time']).removeClass('hidden');
            $(buttons['bar-line']).removeClass('hidden');
            $(buttons['bar-measurement']).removeClass('hidden');
            $(button).addClass('active');
            $(buttons['bar-empty']).addClass('active');
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3R1ZHlHcmFwaGluZ0hlbHBlck1ldGhvZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTdHVkeUdyYXBoaW5nSGVscGVyTWV0aG9kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxvREFBb0Q7QUFDcEQsOENBQThDO0FBRTlDLElBQUksV0FBZSxDQUFDO0FBRXBCLFdBQVcsR0FBRztJQUVWOzs7T0FHRztJQUNILGdCQUFnQixFQUFDLFVBQVUsT0FBTztRQUM5QixNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7SUFDdEQsQ0FBQztJQUVEOztPQUVHO0lBQ0gsa0JBQWtCLEVBQUMsVUFBVSxPQUFPO1FBQ2hDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksV0FBVyxDQUFDLENBQUMsQ0FBQztZQUN2QyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbEMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQTtRQUNyQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0gsUUFBUSxFQUFFLFVBQVMsUUFBUSxFQUFFLFNBQVM7UUFDbEMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzNCLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN0QixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDWixDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMs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LFFBQVEsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDakQsSUFBSSxNQUFNLEdBQUksQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0MsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM3QyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdDLENBQUMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdCLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0MsQ0FBQztJQUNMLENBQUM7Q0FDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZSBsYXN0IG1vZGlmaWVkIG9uOiBXZWQgT2N0IDI2IDIwMTYgMTE6NTc6NDUgIFxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3R5cGluZ3MvZDMvZDMuZC50c1wiLz47XG5cbnZhciBTdHVkeUhlbHBlcjphbnk7XG5cblN0dWR5SGVscGVyID0ge1xuXG4gICAgLyoqIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gZWxlbWVudCBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiBzZWxlY3RvcnNcbiAgICAgKiBbPGRpdiBpZD3igItcImxpbmVjaGFydFwiPuKAizwvZGl2PuKAiywgPGRpdiBpZD3igItcInRpbWVCYXJcIj7igIs8L2Rpdj7igIssIDxkaXYgaWQ94oCLXCJzaW5nbGVcIj7igIs8L2Rpdj7igIssXG4gICAgICogPGRpdiBpZD3igItcImJhckFzc2F5XCI+4oCLPC9kaXY+4oCLXVxuICAgICAqL1xuICAgIGdldEJ1dHRvbkVsZW1lbnQ6ZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuICQoZWxlbWVudC5zaWJsaW5ncygnOmZpcnN0JykpLmZpbmQoXCJsYWJlbFwiKVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGluIHRoZSBncmFwaERpdiBlbGVtZW50IGFuZCByZXR1cm5zIGFuIGFycmF5IG9mIDQgYnV0dG9uc1xuICAgICAqL1xuICAgIGdldFNlbGVjdG9yRWxlbWVudDpmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBpZiAoJChlbGVtZW50KS5hdHRyKCdpZCcpICE9ICdtYWluZ3JhcGgnKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0b3IgPSBlbGVtZW50LnNpYmxpbmdzKCkuZXEoMSk7XG4gICAgICAgICAgICByZXR1cm4gJChzZWxlY3RvcikuY2hpbGRyZW4oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZWxlbWVudC5zaWJsaW5ncygpLmFkZEJhY2soKVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGluIGFuIGVsZW1lbnQgIHNlbGVjdG9yIGFuZCBhbiBhcnJheSBvZiBzdmcgcmVjdHMgYW5kIHJldHVybnNcbiAgICAgKiByZXR1cm5zIG1lc3NhZ2Ugb3Igbm90aGluZy5cbiAgICAgKi9cbiAgICBzdmdXaWR0aDogZnVuY3Rpb24oc2VsZWN0b3IsIHJlY3RBcnJheSkge1xuICAgICAgICAkKCcudG9vTXVjaERhdGEnKS5yZW1vdmUoKTtcbiAgICAgICAgJCgnLm5vRGF0YScpLnJlbW92ZSgpO1xuICAgICAgICB2YXIgc3VtID0gMDtcbiAgICAgICAgXy5lYWNoKHJlY3RBcnJheSwgZnVuY3Rpb24ocmVjdEVsZW06YW55KSB7XG4gICAgICAgICAgICBpZiAocmVjdEVsZW0uZ2V0QXR0cmlidXRlKFwid2lkdGhcIikgIT0gMCkge1xuICAgICAgICAgICAgICAgIHN1bSsrXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoc3VtID09PSAwKSB7XG4gICAgICAgICAgICAkKHNlbGVjdG9yKS5wcmVwZW5kKFwiPHAgY2xhc3M9JyB0b29NdWNoRGF0YSc+VG9vIG1hbnkgZGF0YSBwb2ludHMgdG8gZGlzcGxheVwiICtcbiAgICAgICAgICAgICAgICBcIjwvcD48cCAgY2xhc3M9JyB0b29NdWNoRGF0YSc+UmVjb21tZW5kIGZpbHRlcmluZyBieSBwcm90b2NvbDwvcD5cIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gdGhlIEVERERhdGEuTWVhc3VyZW1lbnRUeXBlcyBvYmplY3QgYW5kIHJldHVybnMgdGhlIG1lYXN1cmVtZW50IHR5cGVcbiAgICAgKiAgdGhhdCBoYXMgdGhlIG1vc3QgZGF0YSBwb2ludHMgLSBvcHRpb25zIGFyZSBiYXNlZCBvbiBmYW1pbHkgcCwgbSwgLSwgZXRjLlxuICAgICAqL1xuICAgIG1lYXN1cmVtZW50VHlwZTogZnVuY3Rpb24odHlwZXMpIHtcbiAgICAgICAgdmFyIHByb3Rlb21pY3MgPSB7fTtcbiAgICAgICAgZm9yICh2YXIgdHlwZSBpbiB0eXBlcykge1xuICAgICAgICAgICAgaWYgKHByb3Rlb21pY3MuaGFzT3duUHJvcGVydHkodHlwZXNbdHlwZV0uZmFtaWx5KSkge1xuICAgICAgICAgICAgICAgIHByb3Rlb21pY3NbdHlwZXNbdHlwZV0uZmFtaWx5XSsrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwcm90ZW9taWNzW3R5cGVzW3R5cGVdLmZhbWlseV0gPSAwXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIga2V5IGluIHByb3Rlb21pY3MpIHtcbiAgICAgICAgICAgIHZhciBtYXg6YW55ID0gMDtcbiAgICAgICAgICAgIHZhciBtYXhUeXBlOmFueTtcbiAgICAgICAgICAgIGlmIChwcm90ZW9taWNzW2tleV0gPiBtYXgpIHtcbiAgICAgICAgICAgICAgICBtYXggPSBwcm90ZW9taWNzW2tleV07XG4gICAgICAgICAgICAgICAgbWF4VHlwZSA9IGtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbWF4VHlwZTtcbiAgICB9LFxuXG4gICAgIC8qKiB0aGlzIGZ1bmN0aW9uIHRha2VzIGluIHRoZSBzZWxlY3RlZCBidXR0b24gYW5kIGFuIGFycmF5IG9mIGJ1dHRvbiBzZWxlY3RvcnMgYW5kIGFjdGl2YXRlc1xuICAgICAgKiAgb3IgZGVhY3RpdmF0ZXMgYnV0dG9ucy5cbiAgICAgICovXG4gICAgYmFyR3JhcGhBY3RpdmVCdXR0b246IGZ1bmN0aW9uKHNlbGVjdGVkQnV0dG9uLCBidXR0b25zKSB7XG4gICAgICAgIHZhciBiYXJCdXR0b24gPSBidXR0b25zWzFdO1xuXG4gICAgICAgICQoYnV0dG9ucykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAkKGJhckJ1dHRvbikuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAkKHNlbGVjdGVkQnV0dG9uKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgfSxcblxuXG4gICAgLyoqXG4gICAgICogdGhpcyBmdW5jdGlvbiB0YWtlcyBpbiB0aGUgc2VsZWN0b3Igb2JqZWN0IGFuZCBzZWxlY3RvciB0eXBlIGFuZCBkaXNwbGF5cyBvciBoaWRlcyB0aGUgZ3JhcGhcbiAgICAgKi9cbiAgICBkaXNwbGF5R3JhcGg6IGZ1bmN0aW9uKHNlbGVjdG9ycywgc2VsZWN0b3IpIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHNlbGVjdG9ycykge1xuICAgICAgICAgICAgaWYgKGtleSA9PT0gc2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgICBkMy5zZWxlY3Qoc2VsZWN0b3JzW2tleV0pLnN0eWxlKCdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdChzZWxlY3RvcnNba2V5XSkuc3R5bGUoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gdGhlIGV2ZW50LCBzZWxlY3RvciB0eXBlLCByZWN0IG9iaiwgc2VsZWN0b3Igb2JqZWN0IGFuZFxuICAgICAqIGhhbmRsZXMgdGhlIGJ1dHRvbiBldmVudC5cbiAgICAgKi9cbiAgICBidXR0b25FdmVudEhhbmRsZXI6IGZ1bmN0aW9uKG5ld1NldCwgZXZlbnQsIHJlY3QsIHNlbGVjdG9yLCBzZWxlY3RvcnMsIGJ1dHRvbkFycikge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKG5ld1NldC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAkKHNlbGVjdG9yc1tzZWxlY3Rvcl0pLnByZXBlbmQoXCI8cCBjbGFzcz0nbm9EYXRhJz5ObyBkYXRhIHNlbGVjdGVkIC0gcGxlYXNlIFwiICtcbiAgICAgICAgICAgICAgICBcImZpbHRlcjwvcD5cIilcbiAgICAgICAgICAgICAgICAkKCcudG9vTXVjaERhdGEnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJy5ub0RhdGEnKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICBTdHVkeUhlbHBlci5zdmdXaWR0aChzZWxlY3RvcnNbc2VsZWN0b3JdLCByZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFN0dWR5SGVscGVyLmRpc3BsYXlHcmFwaChzZWxlY3RvcnMsIHNlbGVjdG9yKTtcbiAgICAgICAgICAgIFN0dWR5SGVscGVyLmJhckdyYXBoQWN0aXZlQnV0dG9uKHRoaXMsIGJ1dHRvbkFycik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHRoaXMgZnVuY3Rpb24gdGFrZXMgaW4gdGhlIHR5cGUgb2YgbWVhc3VyZW1lbnQsIHNlbGVjdG9ycyBvYmosIHNlbGVjdG9yIHR5cGUgYW5kXG4gICAgICogYnV0dG9uIG9iaiBhbmQgc2hvd3MgdGhlIG1lYXN1cmVtZW50IGdyYXBoIGlzIHRoZSBtYWluIHR5cGUgaXMgcHJvdGVvbWljXG4gICAgICovXG4gICAgc2hvd1Byb3Rlb21pY0dyYXBoOiBmdW5jdGlvbih0eXBlLCBzZWxlY3RvcnMsIHNlbGVjdG9yLCBidXR0b25zKSB7XG4gICAgICAgIGlmICh0eXBlID09PSdwJykge1xuICAgICAgICAgICAgZDMuc2VsZWN0KHNlbGVjdG9yc1snbGluZSddKS5zdHlsZSgnZGlzcGxheScsICdub25lJyk7XG4gICAgICAgICAgICBkMy5zZWxlY3Qoc2VsZWN0b3JzWydiYXItbWVhc3VyZW1lbnQnXSkuc3R5bGUoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgICAgICQoJ2xhYmVsLmJ0bicpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIHZhciByZWN0cyA9IGQzLnNlbGVjdEFsbCgnLmdyb3VwZWRNZWFzdXJlbWVudCByZWN0JylbMF07XG4gICAgICAgICAgICBTdHVkeUhlbHBlci5zdmdXaWR0aChzZWxlY3RvcnNbc2VsZWN0b3JdLCByZWN0cyk7XG4gICAgICAgICAgICB2YXIgYnV0dG9uID0gICQoJy5ncm91cEJ5TWVhc3VyZW1lbnRCYXInKVswXTtcbiAgICAgICAgICAgICQoYnV0dG9uc1snYmFyLXRpbWUnXSkucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgICAgJChidXR0b25zWydiYXItbGluZSddKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgICAkKGJ1dHRvbnNbJ2Jhci1tZWFzdXJlbWVudCddKS5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICAgICAkKGJ1dHRvbikuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgJChidXR0b25zWydiYXItZW1wdHknXSkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICB9XG4gICAgfVxufTsiXX0=