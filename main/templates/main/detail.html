{% extends "edd_base.html" %}
{% load staticfiles %}
{% load firstof from future %}


{% block js_css %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'main/js/Dragboxes.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/EDDEditing.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/DataGrid.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/Utl.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.crosshair.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.resize.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.navigate.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.dashes.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.threshold.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.orderbars.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.flot.stack.js' %}"></script>
    
    <script type="text/javascript" src="{% static 'main/js/lib/qtip/jquery.qtip.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'main/js/lib/qtip/jquery.qtip.min.css' %}" />

    <script type="text/javascript" src="{% static 'main/js/lib/jquery-ui/jquery-ui.min.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'main/js/lib/jquery-ui/jquery-ui.min.css' %}" />

    <script type="text/javascript" src="{% static 'main/js/Autocomplete.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/EditableElement.js' %}"></script>

    {# only used in PermissionsDialog.js, replace and remove #}
    <script type="text/javascript" src="{% static 'main/js/lib/jquery.bind-first/jquery.bind-first.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/PermissionsDialog.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/BiomassCalculationUI.js' %}"></script>
    
    <script type="text/javascript" src="{% static 'main/js/Study.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/StudyGraphing.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/CarbonSummation.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/StudyCarbonBalance.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/StudySBMLExport.js' %}"></script>
{% endblock js_css %}


{% block head_title %}
    {{ study.name }} - Experiment Data Depot
{% endblock head_title %}


{% block body_title %}
    <h1>{{ study.name }}</h1>
{% endblock body_title %}


{% block content %}
    <div class="pageSection">
        <div class="sectionHead" id="genInfoViewBanner">General Information</div>
        <div class="sectionContent" id="genInfoView">
            <dl class="infolist">
                <dt>Description</dt>
                <dd>{% firstof study.description "<i>(None)</i>"|safe %}</dd>
                <dt>Contact</dt>
                <dd>{% if study.contact %}
                    <a href="mailto:{{ study.contact.email }}">{{ study.contact.first_name }} {{ study.contact.last_name }}</a>
                    {% elif study.contact_extra %}
                    {{ study.contact_extra }}
                    {% else %}
                    (None)
                    {% endif %}
                </dd>
            </dl>
        </div>
        <form method="POST" enctype="multipart/form-data"
              action="/study/{{ study.id }}/attach">
        {% csrf_token %}
        {% with attachments=study.attachments %}
            {% include "main/include_attachments.html" %}
        {% endwith %}
        </form>
        <div class="disclose discloseHide">
            <div class="sectionChapter" id="commentsBanner">
                <span class="discloseLink"><span>Comments</span></span>
            </div>
            <div class="sectionActions discloseBody" id="commentActionPanel">TODO</div>
        </div>
    </div>
        
    <form action="" method="POST" enctype="multipart/form-data">
        <div class="pageSectionTabs" id="graphTabsOverviewSelected">
            <div class="active absoverlay">Data Overview</div>
            <div class="active">Data Overview</div>
        </div>
        <div class="pageSection pageSectionTabContent" id="overviewSection">
            <div class="sectionContent">
                <div id="maingraph" class="graphContainer"></div>
            </div>
            <div class="sectionChapter disclose discloseHide">
                <span class="discloseLink"><span>Filtering</span></span>
                <span class="tableControl">
                    <input type="checkbox" id="separateAxesCheckbox" value="1" />
                    <label for="separateAxesCheckbox">Separate Y Axes for Measurement Types</label>
                </span>
                <span class="tableControl" id="pointsDisplayedSpan"></span>
            </div>
            <div id="mainFilterSection" class="filteringSection off">
                <div class="filterTable"></div>
            </div>
        </div>
    </form>
        
    <div class="pageSection minor disclose discloseHide" id="lineMain">
        <div class="sectionHead">
            <span class="discloseLink"><a href="#">Add A New Line</a></span>
            <div class="discloseAlt" style="float:right;">
                <button>Import Lines</button>
            </div>
            <div class="clear"></div>
        </div>
        <div class="sectionContent discloseBody">
            <form action="" method="POST">
                {% csrf_token %}
                <div>
                    <label for="id_line_name">Line Name</label>
                    <input id="id_line_name" type="text" name="line_name" maxlength="255" />
                </div>
                {# TODO finish form elements #}
                <button type="submit">Add Line</button>
            </form>
        </div>
    </div>
    <div class="pageSection">
        <table id="studyLinesTable"></table>
        {# Above table is populated via Typescript code; below is try at static rendering #}
        {% comment %}
        <table id="testLinesTable">
            <tr>
                <th>{# checkbox column #}</th>
                <th>Line Name</th>
                {% for meta in line_meta %}
                <th>{{ meta.type_name }}</th>
                {% endfor %}
            </tr>
            {% for line in lines %}
            <tr>
                <td>{# checkbox column #}</td>
                <td>{{ line.name }} {% if line.control %}<span>c</span>{% endif %}</td>
                {% for meta in line_meta %}
                <td>{{ line.get_metadata_json|lookup:meta.pk }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
        {% endcomment %}
        <div id="linesActionPanel" class="sectionActions off">
            <span id="linesSelectedCell">0 selected</span>
            <button id="cloneLineButton">Clone Line</button>
            <button id="editLineButton">Edit Line</button>
            <button id="groupLineButton">Group As Replicates</button>
            <input type="radio" id="line_action_mark" name="line_action" value="edit"/>
            <label for="line_action_mark">
                <span>Mark as</span>
                <select name="disable">
                    <option value="true">Disabled</option>
                    <option value="false">Enabled</option>
                </select>
            </label>
            <input type="radio" id="line_action_export" name="line_action" value="export"/>
            <label for="line_action_export">
                <span>Export Data</span>
                <select name="export">
                    <option value="csv">as CSV/etc</option>
                    <option value="sbml">to SBML</option>
                </select>
            </label>
            <button type="submit">Take Action</button>
        </div>
    </div>
    
    <div class="pageSection minor disclose discloseHide" id="assayMain">
        <div class="sectionHead">
            <span class="discloseLink"><a href="#">Add Assays To Selected Lines</a></span>
        </div>
        <div class="sectionContent discloseBody">
            <form action="" method="POST">
                {% csrf_token %}
                <div>
                    <label for="id_assay_name">Assay Name</label>
                    <input id="id_assay_name" type="text" name="assay_name" maxlength="255"/>
                </div>
                {# TODO finish form elements #}
                <button type="submit">Add Assay</button>
            </form>
        </div>
    </div>
    <div class="pageSection" id="assaysSection"></div>

    <div class="pageSection minor disclose discloseHide" id="measurementMain">
        <div class="sectionHead">
            <span class="discloseLink"><a href="#">Add Measurements To Selected Assays</a></span>
        </div>
        <div class="sectionContent discloseBody">
            <form action="" method="POST">
                {% csrf_token %}
                <div>
                    <label for="id_measurement_type">Measurement Type</label>
                    <input id="id_measurement_type" type="text" name="measurement_type"
                            maxlength="255"/>
                </div>
                {# TODO finish form elements #}
                <button type="submit">Add Measurement</button>
            </form>
        </div>
    </div>

    <div class="bare-header">
        <a href="/study/{{ study.id }}/import">Import tabular data...</a>
    </div>
    
{% endblock content %}
