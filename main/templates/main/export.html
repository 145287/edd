{% extends "edd_base.html" %}
{% load staticfiles %}

{% block js_css %}
  {{ block.super }}
  <script type="text/javascript" src="{% static 'main/js/lib/jquery/jquery.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/Dragboxes.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/EDDEditing.js' %}"></script>
  <script type="text/javascript">
  //<![CDATA[
  EDDData = { }; // Declaring the object for later use

  $(document).on('click', '.disclose .discloseLink', function (e) {
    $(e.target).closest('.disclose').toggleClass('discloseHide');
    return false;
  });

  //]]>
  </script>
  <script type="text/javascript" src="{% static 'main/js/Utl.js' %}"></script>
  <script type="text/javascript" src="{% static 'main/js/DataGrid.js' %}"></script>
{% endblock js_css %}

{% block head_title %}
  Data Export For {{ study.name }}
{% endblock head_title %}

{% block body_title %}
  Data Export For <a href="/study/{{ study.id }}">{{ study.name }}</a>
{% endblock body_title %}

{% block content %}

{% if error_message %}
<h3 style="color: #ff0000; font-weight: bold">{{ error_message }}</h3>

{% else %}
<div class="disclose discloseHide" id="existinglineshide">
  <div style="margin:10px">
    <a href="#" class="discloseLink">
      {{ select_form.measurements|length }} Measurements in {{ select_form.assays|length }} Assays in {{ select_form.lines|length }} Lines Selected
    </a>
  </div>
  <div id="existingLinesSection" class="pageSection discloseBody" style="border-width:1px;margin:10px;">  
    {% include "main/include_linetable.html" %}
  </div>
</div>

<!-- start of main form -->
<form method="post" id="exportForm" action="/study/{{ study.id }}/export">
  {% csrf_token %}
  <div class="pageSection" id="mainModeDiv">
    <div class="sectionHead">Specify the layout of the data you wish to export.</div>
    <div class="sectionContent exportOptions">
      {{ select_form.as_p }}
      {{ option_form.as_p }}
      <button type="submit" name="apply">Apply</button>
      <button type="submit" name="download">Download</button>
    </div>
  </div>
</form>

<!-- display section -->
<div class="pageSection">
  <div class="sectionHead">View the current output here</div>
  <div class="sectionContent exportDisplay">
    <p>
      <textarea class="dataTextArea" rows="32" id="textData" name="textData">{{ view.export_output }}</textarea>
    </p>
  </div>
</div>
{% endif %}

{% endblock content %}
