{% extends "main/study.html" %}
{% load staticfiles %}

{% block js_css %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'main/js/lib/underscore/underscore.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/d3/d3.v2.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/d3/d3.tip.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/DataGrid.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/EDDGraphingTools.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/StudySBMLExport.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/createMultiAxisLine.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/Study-Data.js' %}"></script>
{% endblock js_css %}

{% block head_title %}
    {{ block.super }}
{% endblock head_title %}

{% block body_prefix %}
    {{ block.super }}
<form action="" class="noMargins" style="height:100%;" method="POST">
    {% csrf_token %}
{% endblock body_prefix %}

{% block body_title %}
    {{ block.super }}
{% endblock body_title %}

{% block content %}
    {{ block.super }}

<div class="buttonBar" id="displayModeButtons">
    <span class="active" id="lineGraphButton" for="graphDisplayContainer">
        <img src="{% static 'main/images/study-data-icon-lines.png' %}" style="vertical-align: bottom" width="18" height="18" />
        Line Graph
    </span><span id="barGraphButton" for="graphDisplayContainer">
        <img src="{% static 'main/images/study-data-icon-bars.png' %}" style="vertical-align: bottom" width="18" height="18" />
        Bar Graphs
    </span><span id="dataTableButton" for="studyAssaysTable">
        <img src="{% static 'main/images/study-data-icon-chart.png' %}" style="vertical-align: bottom" width="18" height="18" />
        Table
    </span>
<div class="buttonBar off" id="barGraphTypeButtons">
    <span id="timeBarGraphButton" class="active" for="barGraphByTime">
        Time
    </span><span id="lineBarGraphButton" for="barGraphByLine">
        Line
    </span><span id="measurementBarGraphButton" for="barGraphByMeasurement">
        Measurement
    </span>
</div>
        <div id="filterControlsArea" style="margin:auto 0 auto 15px;">
        <div id="filterControlsMenu" class="pulldownMenu">
            <div id="filterControlsMenuLabel" class="pulldownMenuLabelOff">View options â–¾</div>
            <div class="pulldownMenuMenuBlock off">
                <ul>
                    <li>
                        <input id="filteringShowDisabledCheckbox" name="filteringShowDisabled" type="checkbox" value="1">
                        <label for="filteringShowDisabledCheckbox" title="Show assays that have been disabled.">Show Disabled</label>
                    </li>
                    <li>
                        <input id="filteringShowEmptyCheckbox" name="filteringShowEmpty" type="checkbox" value="1">
                        <label for="filteringShowEmptyCheckbox" title="Show assays that don't have any measurements in them.">Show Empty</label>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div id="tableControlsArea" class="off" style="margin:auto 0 auto 0;">
            {# filled out client-side #}
    </div>
</div>




<div id="graphDisplayContainer">
    <div id="noData" class="off" style="
        height: 300px;
        width: 100%;
        padding:auto;
        text-align: center;
        vertical-align: middle;">
        No measurements.
    </div>
    <div id="tooManyPoints" class="off" style="
        height: 300px;
        width: 100%;
        padding:auto;
        text-align: center;
        vertical-align: middle;">
        Too many points to display!  Please change your filter settings.
    </div>
    <div id="graphLoading" class="wait-larger" style="
        opacity:0.7;
        height: 300px;
        width: 100%;
        padding:auto;">
    </div>
    <div id="lineGraph" class="off"></div>
    <div id="barGraphByTime" class="off"></div>
    <div id="barGraphByLine" class="off"></div>
    <div id="barGraphByMeasurement" class="off"></div>
</div>

{# studyLinesTable will have checkboxes; name=lineId, value=pk #}
<table id="studyAssaysTable" class="off"></table>

<div id="assaysActionPanel" class="sectionActions" style="
    display:flex;
    flex-direction: row;
    justify-content: flex-start; /* align items in Main Axis */
    align-items: stretch; /* align items in Cross Axis */
    align-content: stretch; /* Extra space in Cross Axis */
    flex-wrap: nowrap;">

    <div style="
        flex-grow:0;
        margin:0 15px 0 auto;
        font-size:0.9em;
        display:flex;
        flex-direction: column;
        justify-content: center;
        " class="{% if not assays %}off{% endif %}">
        <div id="displayedDiv" style="padding:1px;">0 displayed</div>
        <div id="selectedDiv" style="padding:1px;">0 selected</div>
    </div>
<div class="off">
    <input id="assay_action_mark" type="radio" name="assay_action" value="mark"/>
    <label for="assay_action_mark">
                    <span>Mark as</span>
                    <select name="disable">
                        <option value="true">Disabled</option>
                        <option value="false">Enabled</option>
                    </select>
    </label>
    <input id="assay_action_delete" type="radio" name="assay_action" value="delete" />
    <label for="assay_action_delete">Delete Measurements</label>
    <input id="assay_action_edit" type="radio" name="assay_action" value="edit" />
    <label for="assay_action_edit">Edit Measurements</label>
    <input id="assay_action_export" type="radio" name="assay_action" value="export" />
    <label for="assay_action_export">Export Data</label>
    <button name="action" type="submit" value="assay_action">Take Action</button>
    <div class="clear"></div>
</div>
    <div id="tableActionButtons" class="off" style="margin:auto 0 auto 0;">
        <button id="editMeasurementButton"
                class="actionButton {% if not writable or not assays %}off{% endif %}"
                disabled="true"
                title="Edit selected measurements">
            Edit Measurements
        </button>
        <button id="addMeasurementButton"
                class="actionButton {% if not writable or not assays %}off{% endif %}"
                type="button"
                disabled="true"
                title="Add a measurement to selected assays">
            Add Measurement
        </button>
        <button id="deleteButton"
                class="actionButton {% if not writable or not assays %}off{% endif %}"
                type="submit"
                name="action"
                disabled="true"
                title="Delete selected assays and/or measurements">
            Delete
        </button>
        <button id="disableButton"
                class="actionButton {% if not writable or not assays %}off{% endif %}"
                type="submit"
                name="action"
                value="disable"
                disabled="true"
                title="Disable selected assays and/or measurements">
            Disable
        </button>
        <button id="enableButton"
                class="actionButton off"
                type="submit"
                name="action"
                value="enable"
                disabled="true"
                title="Re-enable selected assays and/or measurements">
            Re-Enable
        </button>
    </div>


    <div style="margin:auto 30px auto 15px;" class="{% if not assays %}off{% endif %}" title="Add New Line">
        <button type="button" id="exportButton" class="actionButton primary off">
            Export Data
        </button>
    </div>
</div>

<div>
    <input id="hideFilterSection"type="button" style="margin: 14px 0px 0px 15px;" value="Hide Filter Section">
</div>

<div id="mainFilterSection" class="filteringSection">
</div>

{% endblock content %}

{% block body_postfix %}
</form>

{# FUN FACT: jQueryUI's "modal" widget actually rips the element you're turning into a modal right out of the DOM and appends it to the end, thus separating it from any form you've declared outside the modal contents.  So, we are forced to create four self-contained forms, even though the page could easily work as one. #}

<div id="addMeasurement" class="off" title="Add Measurements To Selected Assays">
    <form action="" method="POST">
        {% csrf_token %}
        {{ new_measurement.as_p }}
        <button type="submit" name="action" value="measurement">Add Measurement</button>
    </form>
</div>

<div id="assayMain" class="off" title="Edit Assay">
    <form action="" method="POST">
        {% csrf_token %}
        {{ new_assay.as_p }}
        <button type="submit" name="action" value="measurement">{% if new_assay.is_editing %}Edit Assay{% else %}Add Assay{% endif %}</button>
    </form>
</div>

    {{ block.super }}
{% endblock body_postfix %}