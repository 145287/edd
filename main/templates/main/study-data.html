{% extends "main/study.html" %}
{% load staticfiles %}
{% load i18n %}

{% block js_css %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'main/js/lib/underscore/underscore.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/d3/d3.v2.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/lib/d3/d3.tip.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/DataGrid.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/EDDGraphingTools.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/StudySBMLExport.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/Study-Data.js' %}"></script>
    <script type="text/javascript" src="{% static 'main/js/Utl.js' %}"></script>
    <script type="text/javascript">
        $(document).ajaxStop(function() {
            // show assay table by default if there are assays but no assay measurements
            if (_.keys(EDDData.Assays).length > 0 && _.keys(EDDData.AssayMeasurements).length === 0) {
                //TODO: create prepare it for no data?
                $('#dataTableButton').click();
            }
        });
    </script>
{% endblock js_css %}

{% block head_title %}
    {{ block.super }}
{% endblock head_title %}

{% block body_title %}
    {{ block.super }}
{% endblock body_title %}

{% block content %}
    {{ block.super }}

<div class="buttonBar" id="displayModeButtons">
    <span class="active" id="lineGraphButton" for="graphDisplayContainer">
        <img src="{% static 'main/images/study-data-icon-lines.png' %}"
                style="vertical-align: bottom" width="18" height="18" />
        {% trans 'Line Graph' %}
    </span><span id="barGraphButton" for="graphDisplayContainer">
        <img src="{% static 'main/images/study-data-icon-bars.png' %}"
                style="vertical-align: bottom" width="18" height="18" />
        {% trans 'Bar Graphs' %}
    </span><span id="dataTableButton" for="studyAssaysTable">
        <img src="{% static 'main/images/study-data-icon-chart.png' %}"
                style="vertical-align: bottom" width="18" height="18" />
        {% trans 'Table' %}
    </span>
    <div class="buttonBar off" id="barGraphTypeButtons">
        <span id="measurementBarGraphButton" class="active" for="barGraphByMeasurement">
            {% trans 'Measurement' %}
        </span>
        <span id="lineBarGraphButton" for="barGraphByLine">
            {% trans 'Line' %}
        </span>
        <span id="timeBarGraphButton" for="barGraphByTime">
            {% trans 'Time' %}
        </span>
    </div>
    <div id="filterControlsArea" style="margin:auto 0 auto 15px;">
        <div id="filterControlsMenu" class="pulldownMenu">
            <div id="filterControlsMenuLabel"
                    class="pulldownMenuLabelOff">{% trans 'View options' %} â–¾</div>
            <div class="pulldownMenuMenuBlock off">
                <ul>
                    <li>
                        <input id="filteringShowDisabledCheckbox" name="filteringShowDisabled"
                                type="checkbox" value="1">
                        <label for="filteringShowDisabledCheckbox"
                                title="{% trans 'Show assays that have been disabled.' %}">
                            {% trans 'Show Disabled' %}
                        </label>
                    </li>
                    <li>
                        <input id="filteringShowEmptyCheckbox" name="filteringShowEmpty"
                                type="checkbox" value="1">
                        <label for="filteringShowEmptyCheckbox"
                                title="{% trans 'Show assays that do not have any measurements in them.' %}">
                            {% trans 'Show Empty' %}
                        </label>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div id="tableControlsArea" class="off" style="margin:auto 0;">
        {# filled out client-side #}
    </div>
</div>

<div id="graphDisplayContainer">
    <div id="noData" class="off" style="
        height: 300px;
        width: 100%;
        padding:auto;
        text-align: center;
        vertical-align: middle;">
        No measurements.
    </div>
    <div id="tooManyPoints" class="off" class="tooManyPoints">
        {% trans 'Too many points to display!  Please change your filter settings.' %}
    </div>
    <div id="graphLoading" class="wait-larger" style="
        opacity:0.7;
        height: 300px;
        width: 100%;
        padding:auto;">
    </div>
    <div id="lineGraph" class="off"></div>
    <div id="barGraphByMeasurement" class="off"></div>
    <div id="barGraphByLine" class="off"></div>
    <div id="barGraphByTime" class="off"></div>
</div>

<form action="" method="POST">
{% csrf_token %}
{# studyLinesTable will have checkboxes; name=lineId, value=pk #}
<table id="studyAssaysTable" class="off"></table>

<div id="assaysActionPanel" class="sectionActions assayActions">
    <button class="hideFilterSection" style="margin: 14px 0px 0px 15px;"
            data-off-text="{% trans 'Show Filter Section' %}">
        {% trans 'Hide Filter Section' %}
    </button>

    <div class="{% if not assays %}off{% endif %} assayFlex">
        {# TODO: this gets replaced in Typescript, figure out i18n there #}
        <div id="displayedDiv" class="displayedDiv assayDisplayed">{% trans '0 displayed' %}</div>
        <div id="selectedDiv" class="selectedDiv assayDisplayed">{% trans '0 selected' %}</div>
    </div>
    <div class="off">
        <input id="assay_action_delete" type="radio" name="assay_action" value="delete" />
        <label for="assay_action_delete">{% trans 'Delete Measurements' %}</label>
        <input id="assay_action_edit" type="radio" name="assay_action" value="edit" />
        <label for="assay_action_edit">{% trans 'Edit Measurements' %}</label>
        <input id="assay_action_export" type="radio" name="assay_action" value="export" />
        <label for="assay_action_export">{% trans 'Export Data' %}</label>
        <button name="action" type="submit" value="assay_action">{% trans 'Take Action' %}</button>
        <div class="clear"></div>
    </div>
    <div id="tableActionButtons" class="tableActionButtons off" style="margin:auto 0;">
        <button id="editMeasurementButton"
                class="editMeasurementButton actionButton {% if not writable or not assays %}off{% endif %}"
                disabled="true"
                title="{% trans 'Edit selected measurements' %}">
            {% trans 'Edit Measurements' %}
        </button>
        <button id="addMeasurementButton"
                class="addMeasurementButton actionButton {% if not writable or not assays %}off{% endif %}"
                type="button"
                disabled="true"
                title="{% trans 'Add a measurement to selected assays' %}">
            {% trans 'Add Measurement' %}
        </button>
        <button id="deleteButton"
                class="deleteButton actionButton {% if not writable or not assays %}off{% endif %}"
                type="submit"
                name="action"
                value="disable"
                disabled="true"
                title="{% trans 'Delete selected assays and/or measurements' %}">
            {% trans 'Delete' %}
        </button>
        <button id="enableButton"
                class="enableButton actionButton off"
                type="submit"
                name="action"
                value="enable"
                disabled="true"
                title="{% trans 'Restore selected assays and/or measurements' %}">
            {% trans 'Restore' %}
        </button>
    </div>


    <div style="margin:auto 30px auto 15px;" class="{% if not assays %}off{% endif %}">
        <button type="button" id="exportButton" class="exportButton actionButton primary off"
                title="{% trans 'Export your data in a file type of your choosing' %}">
            {% trans 'Export Data' %}
        </button>
    </div>
</div>
</form>

<div id="mainFilterSection" class="filteringSection"></div>

<div id="addMeasurement" class="off" title="{% trans 'Add Measurements To Selected Assays' %}">
    <form action="" method="POST">
        {% csrf_token %}
        <div class="modal-body">
        {{ new_measurement.as_p }}
        </div>
        <div class="modal-footer">
            <button type="submit" name="action" class="btn btn-primary" value="measurement">{% trans 'Add Measurement' %}</button>
        </div>
    </form>
</div>

<div id="assayMain" class="off" title="Edit Assay">
    <form action="" method="POST">
        {% csrf_token %}
        <div class="modal-body">
        {{ new_assay.as_p }}
        </div>
        <div class="modal-footer">
            <button type="submit" name="action" class="btn btn-primary" value="assay">{% trans 'Edit Assay' %}</button>
        </div>
    </form>
</div>

{% endblock content %}
